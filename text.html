<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script src="./blockly-master/blockly_compressed.js"></script>	<!-- 生成器类文件 -->
  	<script src="./blockly-master/blocks_compressed.js"></script>
  	<script src="./blockly-master/msg/js/en.js"></script>
  	<script src="./blockly-master/python_compressed.js"></script>
  	<script src="./blocks.js"></script>
  	<script src="./factory.js"></script>
	<style>
	    body {
	      background-color: #fff;
	      font-family: sans-serif;
	    }
	    h1 {
	      font-weight: normal;
	      font-size: 140%;
	    }
	    #blocklyDiv{
	    	height: 800px;
	    	width: 100%;
	    }
	    .blocklySvg{
	    	background:#000!important;
	    }
	    button{
	    	width: 100px;
	    	height: 50px;
	    	background-color: #eee;
	    	border:none;
	    	box-shadow: 3px 3px 0 0 #ccc;
	    }

	    .header{
	    	width: 100px;
	    	z-index: 1000;
	    }
	    .blocklyFlyout{
	    	/*display: none;*/
	   	}
	   	.blocklyFlyout .blocklyFlyoutBackground{
	   		fill: rgba(63,63,63,0.)!important;
	   	}
	</style>
</head>
<body>  

	<p>
		<button onclick="showCode()">Show Code</button>
		<button onclick="shouView()">Show View</button>
	</p>

	<div id="blocklyDiv"></div>

	<xml id="toolbox" style="display: none">
	    <category name="控制" colour="200">
		    <block type="controls_if"></block>
		    <block type="controls_whileUntil"></block>
		    <block type="controls_for">

		    <block type="controls_repeat_ext_daluji">
		</category>

	  	<category name="逻辑">
	    	<block type="logic_compare"></block>
		    <block type="logic_operation"></block>
		    <block type="logic_boolean"></block>
	  	</category>

	  	 <category name="Field">
	      <block type="field_static"></block>
	      <block type="field_input"></block>
	      <block type="field_number"></block>
	      <block type="field_angle"></block>
	      <block type="field_dropdown"></block>
	      <block type="field_checkbox"></block>
	      <block type="field_colour"></block>
	      <!--
	      Date picker commented out since it increases footprint by 60%.
	      Add it only if you need it.  See also goog.require in blockly.js.
	      <block type="field_date"></block>
	      -->
	      <block type="field_variable"></block>
	      <block type="field_image"></block>
	    </category>

	  	<category name="Variables" colour="330" custom="VARIABLE"></category>
	  	<category name="Functions" colour="290" custom="PROCEDURE"></category>
	</xml>

	<!-- start 界面显示块 -->
	<xml id="startBlocks" style="display: none">
	    <block type="controls_if" inline="false" x="120" y="20">
	      <mutation else="1"></mutation>
	      <value name="IF0">
	        <block type="logic_compare" inline="true">
	          <field name="OP">EQ</field>
	          <value name="A">

	            <block type="math_arithmetic" inline="true">
	              <field name="OP">MULTIPLY</field>
	              <value name="A">

	                <block type="math_number">
	                  <field name="NUM">6</field>
	                </block>

	              </value>
	              <value name="B">
	                <block type="math_number">
	                  <field name="NUM">7</field>
	                </block>
	              </value>
	            </block>

	          </value>
	          <value name="B">
	            <block type="math_number">
	              <field name="NUM">42</field>
	            </block>
	          </value>
	        </block>
	      </value>

	      <statement name="DO0">
	        <block type="text_print" inline="false">
	          <value name="TEXT">
	            <block type="text">
	              <field name="TEXT">Don't panic</field>
	            </block>
	          </value>
	        </block>
	      </statement>

	      <statement name="ELSE">
	        <block type="text_print" inline="false">
	          <value name="TEXT">
	            <block type="text">
	              <field name="TEXT">Panic</field>
	            </block>
	          </value>
	        </block>
	      </statement>
	    </block>
	</xml>
	<!-- end 界面显示块 -->

	<!-- 代码输入 -->
	<textarea id="text"></textarea>
	<script>
		Blockly.Msg.EVERYTHING_HUE = 42;	//声明一个变量这样


		//start 自定义的 块
		Blockly.Blocks['controls_repeat_ext_daluji'] = {
		  /**
		   * Block for repeat n times (external number).
		   * @this Blockly.Block
		   */
		  init: function() {
		    this.jsonInit({
		      "message0": Blockly.Msg.CONTROLS_REPEAT_TITLE,
		      "args0": [
		        {
		          "type": "input_value",
		          "name": "TIMESa",
		          "check": "Number"
		        }
		      ],
		      "previousStatement": null,
		      "nextStatement": null,
		      "colour": Blockly.Blocks.loops.HUE,
		      "tooltip": Blockly.Msg.CONTROLS_REPEAT_TOOLTIP,
		      "helpUrl": Blockly.Msg.CONTROLS_REPEAT_HELPURL
		    });
		    this.appendStatementInput('DO').appendField(Blockly.Msg.CONTROLS_REPEAT_INPUT_DO);
		  }
		};
		Blockly.Python['controls_repeat_ext_daluji'] = function(block) {
			return 'for count in range(0):pass';
		}
		//end 自定义的块


		//start 配置
	    var workspace = Blockly.inject('blocklyDiv',
	        {
	        	media: './blockly-master/media/',
	         	toolbox: document.getElementById('toolbox'),
	         	sounds: false,	//关闭声音
	         	collapse:true,
	         	trashcan:true,	//垃圾桶
	         	maxTrashcanContents:20,	//垃圾数量
	         	scrollbars:true,	//滚动条
	         	grid:{
	         		spacing: 20,
		        	length: 3,
		          	colour: 'rgba(255, 0, 0,0.2)',
		          	snap: true},
	         	zoom:
		        {
		         	controls: true,
			        wheel: false,	//滚动监听，放大
			        startScale: 1.0,
			        maxScale: 3,
			        minScale: 0.3,
			        scaleSpeed: 1.2
			    }
		     // trashcan: true});
	     	});
	    console.log(workspace);
	    Blockly.Xml.domToWorkspace(document.getElementById('startBlocks'),workspace);

		//end 配置
	

		// var xml = Blockly.Xml.workspaceToDom(workspace);
		// var xml_text = Blockly.Xml.domToText(xml);

		// var xml = Blockly.Xml.textToDom(xml_text);
		// var xml_bl = Blockly.Xml.domToWorkspace(xml, workspace);
		// console.log(xml_text);
		// console.log(xml_bl);



	    //显示代码
	    var t_box = document.getElementById('blocklyDiv');
		var text = document.getElementById('text');
	    
	    function showCode() {
	    	var code = Blockly.Python.workspaceToCode(workspace);
	    	console.log(code);

	    	t_box.style.display="none";

	    	if (text.style.display=="none") {
		    	text.style.display="block";
	    	}else if (text.style.display=="block") {
	    		text.style.display="none";
	    	}

		    text.innerHTML=code;
	    	
	    	console.log(code);
	    }

	    //显示视图
	    function shouView(){
	    	t_box.style.display="block";
	    	text.style.display="none";

	    	return true;
	    }

    </script>



<!-- <script>
  var blocklyArea = document.getElementById('blocklyArea');
  var blocklyDiv = document.getElementById('blocklyDiv');
  
  var workspace = Blockly.inject(blocklyDiv,
      {
      	toolbox: document.getElementById('toolbox')
      });
  console.log(workspace.toolbox);
  var onresize = function(e) {
    // Compute the absolute coordinates and dimensions of blocklyArea.
    var element = blocklyArea;
    var x = 0;
    var y = 0;
    do {
      x += element.offsetLeft;
      y += element.offsetTop;
      element = element.offsetParent;
    } while (element);
    // Position blocklyDiv over blocklyArea.
    blocklyDiv.style.left = x + 'px';
    blocklyDiv.style.top = y + 'px';
    blocklyDiv.style.width = blocklyArea.offsetWidth + 'px';
    blocklyDiv.style.height = blocklyArea.offsetHeight + 'px';
    Blockly.svgResize(workspace);
  };
  window.addEventListener('resize', onresize, false);
  onresize();
  Blockly.svgResize(workspace);
</script>
 -->
  	<script src="./js/js.js"></script>

</body>
</html>